{
  "apps": {
    "tls": {
      "automation": {
        "policies": [
          {
            "subjects": [
              "shiryaev.am",
              "shiryaevam.pro",
              "shiryaevam.com",
              "shiryaevam.ru",
              "www.shiryaev.am",
              "www.shiryaevam.pro",
              "www.shiryaevam.com",
              "www.shiryaevam.ru"
            ],
            "issuers": [
              {
                "module": "acme",
                "email": "shiryaev.am@mail.ru"
              }
            ]
          }
        ]
      }
    },
    "http": {
      "servers": {
        "srv0": {
          "listen": [":80", ":443"],
          "routes": [
            {
              "match": [{ "host": ["www.shiryaev.am"] }],
              "handle": [{
                "handler": "static_response",
                "status_code": 308,
                "headers": { "Location": ["https://shiryaev.am{uri}"] }
              }]
            },
            {
              "match": [{ "host": ["www.shiryaevam.pro"] }],
              "handle": [{
                "handler": "static_response",
                "status_code": 308,
                "headers": { "Location": ["https://shiryaevam.pro{uri}"] }
              }]
            },
            {
              "match": [{ "host": ["www.shiryaevam.tech"] }],
              "handle": [{
                "handler": "static_response",
                "status_code": 308,
                "headers": { "Location": ["https://shiryaevam.tech{uri}"] }
              }]
            },
            {
              "match": [{ "host": ["www.shiryaevam.com"] }],
              "handle": [{
                "handler": "static_response",
                "status_code": 308,
                "headers": { "Location": ["https://shiryaevam.com{uri}"] }
              }]
            },
            {
              "match": [{ "host": ["www.shiryaevam.ru"] }],
              "handle": [{
                "handler": "static_response",
                "status_code": 308,
                "headers": { "Location": ["https://shiryaevam.ru{uri}"] }
              }]
            },


            {
              "match": [
                { "host": [
                  "shiryaev.am",
                  "shiryaevam.pro",
                  "shiryaevam.com",
                  "shiryaevam.ru"
                ]}
              ],
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "handler": "headers",
                          "response": {
                            "set": {
                              "Strict-Transport-Security": ["max-age=31536000; includeSubDomains; preload"],
                              "X-Frame-Options": ["SAMEORIGIN"],
                              "X-Content-Type-Options": ["nosniff"],
                              "Referrer-Policy": ["strict-origin-when-cross-origin"],
                              "Permissions-Policy": ["geolocation=(), microphone=(), camera=()"],
                              "Content-Security-Policy": [
                                "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'"
                              ]
                            }
                          }
                        },
                        { "handler": "encode", "encodings": { "zstd": {}, "gzip": {} } }
                      ]
                    },
                    {
                      "match": [
                        { "path_regexp": { "name": "static", "pattern": 
                          ".*\\.(?:js|css|png|jpg|jpeg|gif|ico|svg|woff2?|ttf|eot|webp|avif)$" } }
                      ],
                      "handle": [
                        {
                          "handler": "headers",
                          "response": {
                            "set": {
                              "Cache-Control": ["public, max-age=31536000, immutable"]
                            }
                          }
                        },
                        {
                          "handler": "file_server",
                          "root": "/usr/share/caddy"
                        }
                      ]
                    },
                    {
                      "match": [ { "file": { "try_files": ["{http.request.uri.path}"] } } ],
                      "handle": [
                        {
                          "handler": "file_server",
                          "root": "/usr/share/caddy"
                        }
                      ]
                    },
                    {
                      "handle": [
                        { "handler": "rewrite", "uri": "/index.html" },
                        { "handler": "file_server", "root": "/usr/share/caddy" }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  }
}


